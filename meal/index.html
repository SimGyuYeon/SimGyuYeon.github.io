<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ìš°ë¦¬ì§‘ ì €ë… ë©”ë‰´ ê¸°ë¡</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
      body { font-family: sans-serif; padding: 1rem; }
      section { margin-bottom: 2rem; }
      .item { border: 1px solid #ccc; padding: 0.5rem; margin-bottom: 0.5rem; }
      button { margin-left: 0.5rem; }
    </style>
  </head>
  <body>
    <h1>ğŸ½ï¸ ì €ë… ë©”ë‰´ ê¸°ë¡ ê´€ë¦¬</h1>

    <section>
      <h2>âœ… ì‹ì‚¬ ê¸°ë¡</h2>
      <input id="meal-title" placeholder="ë©”ë‰´ ì´ë¦„" />
      <input id="meal-date" type="date" />
      <button onclick="addMeal()">ì¶”ê°€</button>
      <div id="meal-list"></div>
    </section>

    <section>
      <h2>ğŸ¥¬ ëƒ‰ì¥ê³  ì¬ë£Œ</h2>
      <input id="fridge-name" placeholder="ì¬ë£Œëª…" />
      <input id="fridge-qty" type="number" placeholder="ìˆ˜ëŸ‰" />
      <input id="fridge-unit" placeholder="ë‹¨ìœ„" />
      <button onclick="addFridge()">ì¶”ê°€</button>
      <div id="fridge-list"></div>
    </section>

    <section>
      <h2>ğŸ“… ì‹ë‹¨ ê³„íš</h2>
      <input id="plan-title" placeholder="ê³„íš ë©”ë‰´" />
      <input id="plan-date" type="date" />
      <button onclick="addPlan()">ì¶”ê°€</button>
      <div id="plan-list"></div>
    </section>

    <script>
      const endpoint = 'https://nameless-hat-e0af.sgy311.workers.dev';

      async function loadData(type) {
        const res = await fetch(`${endpoint}/${type}`);
        const json = await res.json();
        const listEl = document.getElementById(`${type}-list`);
        listEl.innerHTML = '';

        json.results.forEach(item => {
          const title = item.properties.Title.title?.[0]?.plain_text || '(ì œëª© ì—†ìŒ)';
          const id = item.id;
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <b>${title}</b>
            <button onclick="editItem('${type}', '${id}', prompt('ìƒˆ ì´ë¦„', '${title}'))">ìˆ˜ì •</button>
            <button onclick="deleteItem('${type}', '${id}')">ì‚­ì œ</button>
          `;
          listEl.appendChild(div);
        });
      }

      async function addMeal() {
        const title = document.getElementById('meal-title').value;
        const date = document.getElementById('meal-date').value;
        await axios.post(`${endpoint}/meals`, { title, date });
        loadData('meals');
      }

      async function addFridge() {
        const name = document.getElementById('fridge-name').value;
        const quantity = Number(document.getElementById('fridge-qty').value);
        const unit = document.getElementById('fridge-unit').value;
        await axios.post(`${endpoint}/fridge`, { name, quantity, unit });
        loadData('fridge');
      }

      async function addPlan() {
        const title = document.getElementById('plan-title').value;
        const date = document.getElementById('plan-date').value;
        await axios.post(`${endpoint}/plans`, { title, date });
        loadData('plans');
      }

      async function editItem(type, id, newTitle) {
        if (!newTitle) return;
        await axios.patch(`${endpoint}/${type}/${id}`, { title: newTitle });
        loadData(type);
      }

      async function deleteItem(type, id) {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        await axios.patch(`${endpoint}/${type}/${id}`, { archive: true });
        loadData(type);
      }

      loadData('meals');
      loadData('fridge');
      loadData('plans');
    </script>
  </body>
</html>
